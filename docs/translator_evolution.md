# 即時翻譯工具技術沿革

這份文件記錄了「即時翻譯」工具從最初的版本到目前最新版本的技術演進過程。每個階段的修改都為了解決特定的問題，並提升使用者體驗。

## 版本 1.0：基於 HTTP 的單次翻譯

### 架構

*   **前端 (`translator.html`)**：
    *   使用 `MediaRecorder` API 進行錄音。
    *   錄音完成後，將音訊檔案透過 HTTP POST 請求，傳送到後端。
*   **後端 (`routes/translator.py`)**：
    *   使用 Flask 的 HTTP 路由 (`@translator_bp.route('/api/translate-audio', methods=['POST'])`) 接收音訊檔案。
    *   將接收到的音訊檔案，依序進行以下處理：
        1.  **語音轉文字 (STT)**：使用 Azure Speech-to-Text API。
        2.  **文字翻譯**：使用 Google Gemini API。
        3.  **文字轉語音 (TTS)**：使用 Azure Text-to-Speech API。
    *   將處理完的結果 (原文、譯文、音訊)，透過 HTTP 回應，回傳給前端。

### 優點

*   架構簡單，容易理解和實現。
*   適合單次、非即時的翻譯需求。

### 缺點

*   **高延遲**：使用者必須等待「錄音 -> 上傳 -> 處理 -> 下載」的完整流程結束後，才能看到結果。
*   **非即時**：無法在使用者說話的同時，即時顯示翻譯結果。
*   **使用者體驗不佳**：對於需要連續對話的場景，體驗非常不流暢。

## 版本 2.0：基於 WebSocket 的即時串流翻譯

為了解決 1.0 版本的延遲和非即時問題，我們將整個架構從 HTTP 升級為 WebSocket。

### 架構

*   **前端 (`translator.html`)**：
    *   使用 `socket.io.js` 函式庫，與後端建立 WebSocket 連線。
    *   使用 `AudioContext` 和 `ScriptProcessorNode`，即時擷取麥克風的音訊資料流。
    *   將音訊資料流切割成小塊，並透過 WebSocket (`socket.emit('audio_stream', ...)` )，即時傳送到後端。
    *   同時，監聽從後端傳回來的各種事件 (`recognized_sentence`, `translated_sentence`, `translation_audio`)，並即時更新介面。
*   **後端 (`routes/translator.py`)**：
    *   引入 `Flask-SocketIO` 套件，為應用程式提供 WebSocket 支援。
    *   為每個連線的使用者，建立一個 `TranslationSession` 物件，用來管理該使用者的翻譯狀態。
    *   使用 Azure Speech SDK 的連續識別 (continuous recognition) 功能，處理從前端傳來的即時音訊串流。
    *   在語音識別的過程中，透過 WebSocket 將中間結果 (recognizing) 和最終結果 (recognized) 即時傳送給前端。
    *   當一句話識別完成後，立刻進行翻譯和語音合成，並將結果透過 WebSocket 傳送給前端。

### 優點

*   **低延遲**：音訊資料以串流的方式傳送，大幅減少了等待時間。
*   **即時性**：能夠在使用者說話的同時，幾乎同步地顯示原文和譯文。
*   **使用者體驗佳**：提供了流暢、自然的連續對話翻譯體驗。

### 缺點

*   **架構複雜**：相較於 HTTP，WebSocket 的狀態管理和錯誤處理都更加複雜。
*   **資源消耗**：需要為每個連線的使用者，維護一個長連線和一個 `TranslationSession` 物件，對於伺服器資源的消耗較大。

## 版本 2.1：介面優化 - 對話式呈現

在實現了即時翻譯的核心功能後，我們進一步優化了介面的呈現方式，使其更加直覺、美觀。

### 修改內容

*   **後端 (`routes/translator.py`)**：
    *   為每一句識別出來的語音，都加上一個獨一無二的 ID (`sentence_id`)。
*   **前端 (`templates/translator.html`)**：
    *   將原本的 `<textarea>` 替換為可以上下滑動的 `<div>` 容器。
    *   使用 CSS，為每一句原文和譯文，都加上了獨立的對話框樣式。
    *   更新 JavaScript 程式碼，使其能夠根據 `sentence_id`，將原文和譯文準確地對應起來，並動態地新增到畫面上。

### 優點

*   **介面更直覺**：使用者可以清楚地看到每一句話的原文和對應的譯文。
*   **可讀性更高**：對話框的設計，讓長篇的對話更容易閱讀。
*   **使用者體驗更佳**：更接近市面上成熟的翻譯軟體或會議記錄工具的體驗。

## 總結

從 1.0 到 2.1，這個翻譯工具經歷了一次重大的架構升級和一次重要的介面優化。我們從一個簡單的 HTTP 應用開始，逐步解決了延遲、即時性和使用者體驗等問題，最終實現了一個功能完整、體驗流暢的即時翻譯工具。

這個過程不僅僅是程式碼的修改，更重要的是對不同技術方案的理解和權衡。希望這份文件，能幫助您更好地理解我們所做的努力，並在未來的開發中，做出更明智的技術決策。
